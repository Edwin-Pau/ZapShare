<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
        <meta charset="utf-8">
        <title>ZapShare</title>
        <link rel="stylesheet" type="text/css" media="screen" href="css/style-map.css">
        <link rel="stylesheet" type="text/css" media="screen" href="css/style.css">
        <title>ZapShare - Map</title>
        <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
        <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
        <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.1.1/firebaseui.css" />
        <link rel="stylesheet" type="text/css" media="screen" href="css/style.css">
        <link rel="stylesheet" type="text/css" media="screen" href="css/LoginButton.css">
                    <!------------------------------------------------------
        ------------------  Sets up FireBase  ------------------
        ------------------------------------------------------->
        <script src="js/setup_firebase.js"></script>
    </head>

    <body>  
    <div id="id01" class="modal">
        <form class="modal-content animate" action="/action_page.php">
        <div class="imgcontainer">
        <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close">&times;</span>
        </div>
        <div class="container">
            <img src="images/logo.png" alt="logo" id="logo2">
            <div id="firebaseui-auth-container"></div>
            <div id="loader">Loading...</div>  
        </div>
        </form>
    </div>
            <!------------------------------------------------------
            ----------- Header Section Including the Nav Bar  ------
            ------------------------------------------------------->
            <header>
            <div id="navbar">
                <div><a href="index.html"><img src="images/logo.png" id="logo" alt="logo"></a></div>
            <nav>
                <ul>
                    <li><a class="navcurrent" href="index.html">Home</a></li>
                    <li><a class="navnotcurrent" href="about.html">About</a></li>
                    <li><a class="navnotcurrent" href="map.html">Map</a></li>
                    <li><a class="navnotcurrent" href="contact.html">Contact</a></li>
                    <li><button id="loginbutton" onclick="document.getElementById('id01').style.display='block'" style="width:auto;">Login</button></li>
                </ul>
            </nav>
            </div>
            </header>    

            <!------------------------------------------------------
            ---------- Main Section - Contents of the Page ---------
            ------------------------------------------------------->
            <main>
                <div class="loginbuttons">
                <button id="loginbutton" onclick="document.getElementById('id01').style.display='block'">Sign Up</button>
                <button id="logoutbutton" onclick="document.getElementById('id01').style.display='block'">Log In</button>
                </div>
                
                <div id="map-interface">
                    <div id="map-transform">
                        <div id="map-widget-transform">
                            <div id="map-widget">
                                <div id="search-bar-transform">
                                    <div id="search-bar-background">
                                        <input id="origin-input" class="search-bar" type="text"
                                            placeholder="Enter an origin location">
                                        <input id="destination-input" class="search-bar" type="text"
                                            placeholder="Enter a destination location">
                                    </div>
                                </div>
                                <div id="search-text-transform">
                                    <div id="search-text">
                                        No Results Found
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="map"></div>
                        <script>
                            // Note: This example requires that you consent to location sharing when
                            // prompted by your browser. If you see the error "The Geolocation service
                            // failed.", it means you probably did not give permission for the browser to
                            // locate you.
                            var map;
                            var positionVar;
                            var placeIDVar;
                            var placeIDVarSentinel;
                            function initMap() {
                                map = new google.maps.Map(document.getElementById('map'), {
                                    mapTypeControl: false,
                                    center: {lat: 49.2, lng: -123},
                                    zoom: 10.5
                                });
                                var geocoder = new google.maps.Geocoder;
                                var infoWindow = new google.maps.InfoWindow;

                                // Try HTML5 geolocation.
                                if (navigator.geolocation) {
                                    navigator.geolocation.getCurrentPosition(function(position) {
                                        var pos = {
                                            lat: position.coords.latitude,
                                            lng: position.coords.longitude
                                        };

                                        infoWindow.setPosition(pos);
                                        infoWindow.setContent('Location found.');
                                        infoWindow.open(map);
                                        map.setCenter(pos);
                                        positionVar = position.coords.latitude.toString() + "," + position.coords.longitude.toString();
                                        console.log(positionVar);
                                        geocodeLatLng(geocoder, map);
                                    }, function() {
                                        handleLocationError(true, infoWindow, map.getCenter());
                                    });
                                } else {
                                    // Browser doesn't support Geolocation
                                    handleLocationError(false, infoWindow, map.getCenter());
                                }
                                
                                new AutocompleteDirectionsHandler(map);
                                
                            }

                            function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                                infoWindow.setPosition(pos);
                                infoWindow.setContent(browserHasGeolocation ?
                                                      'Error: The Geolocation service failed.' :
                                                      'Error: Your browser doesn\'t support geolocation.');
                                infoWindow.open(map);
                            }
                        // This example requires the Places library. Include the libraries=places
                        // parameter when you first load the API. For example:

                        /**
                         * @constructor
                         */
                        function AutocompleteDirectionsHandler(map) {
                          this.map = map;
                          this.originPlaceId = null;
                          this.destinationPlaceId = null;
                          this.travelMode = 'DRIVING';
                          this.directionsService = new google.maps.DirectionsService;
                          this.directionsDisplay = new google.maps.DirectionsRenderer;
                          this.directionsDisplay.setMap(map);

                          var originInput = document.getElementById('origin-input');
                          var destinationInput = document.getElementById('destination-input');

                          var originAutocomplete = new google.maps.places.Autocomplete(originInput);
                          // Specify just the place data fields that you need.
                          originAutocomplete.setFields(['place_id']);

                          var destinationAutocomplete =
                              new google.maps.places.Autocomplete(destinationInput);
                          // Specify just the place data fields that you need.
                          destinationAutocomplete.setFields(['place_id']);
                          this.setupPlaceChangedListener(originAutocomplete, 'ORIG');
                          this.setupPlaceChangedListener(destinationAutocomplete, 'DEST');
                        }

                        AutocompleteDirectionsHandler.prototype.setupPlaceChangedListener = function(
                            autocomplete, mode) {
                          var me = this;
                          autocomplete.bindTo('bounds', this.map);

                          autocomplete.addListener('place_changed', function() {
                            var place = autocomplete.getPlace();

                            if (!place.place_id) {
                              window.alert('Please select an option from the dropdown list.');
                              return;
                            }
                            if (mode === 'ORIG') {
                                if (placeIDVarSentinel === true) {
                                    me.originPlaceId = placeIDVar;
                                    placeIDVarSentinel = false;
                                } else {
                                    me.originPlaceId = place.place_id;
                                }
                            } else {
                              me.destinationPlaceId = place.place_id;
                            }
                            me.route();
                          });
                        };

                        AutocompleteDirectionsHandler.prototype.route = function() {
                          if (!this.originPlaceId || !this.destinationPlaceId) {
                            return;
                          }
                          var me = this;

                          this.directionsService.route(
                              {
                                origin: {'placeId': this.originPlaceId},
                                destination: {'placeId': this.destinationPlaceId},
                                travelMode: this.travelMode
                              },
                              function(response, status) {
                                if (status === 'OK') {
                                  me.directionsDisplay.setDirections(response);
                                } else {
                                  window.alert('Directions request failed due to ' + status);
                                }
                              });
                        };
                            function geocodeLatLng(geocoder, map) {
                                var input = positionVar;
                                var latlngStr = input.split(',', 2);
                                var latlng = {lat: parseFloat(latlngStr[0]), lng: parseFloat(latlngStr[1])};
                                geocoder.geocode({'location': latlng}, function(results, status) {
                                  if (status === 'OK') {
                                    if (results[0]) {
                                      map.setZoom(11);
                                      var marker = new google.maps.Marker({
                                        position: latlng,
                                        map: map
                                      });
                                        console.log("SUCCESS");
                                        console.log(results);
                                        placeIDVar = results["0"].place_id;
                                        console.log(placeIDVar);
                                        placeIDVarSentinel = true;
                                    } else {
                                      window.alert('No results found');
                                    }
                                  } else {
                                    window.alert('Geocoder failed due to: ' + status);
                                  }
                                });
                              }
                        </script>
                        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBS6lamHTrbNKoFP95FHKKncimETUfGFhg&libraries=places&callback=initMap"
                                async defer></script>
                              <script
                        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBS6lamHTrbNKoFP95FHKKncimETUfGFhg&libraries=places"></script>
                    </div>
                </div>
        </main>
            
        
            <!------------------------------------------------------
            ---------- Footer Section - Links to Subpages ----------
            ------------------------------------------------------->
            <footer>
                <div class="footerfourcolumns">
                    <div class="footercolumn">
                        <div class="footertitle">Quick Links</div>
                        <ul>
                            <li><a href="sitemap.html">Site Map</a></li>
                        </ul>
                    </div>

                    <div class="footercolumn">
                        <div class="footertitle">Policies</div>
                        <ul>
                            <li><a href="privacy.html">Privacy</a></li>
                            <li><a href="disclaimer.html">Disclaimer</a></li>
                            <li><a href="terms.html">Terms of Use</a></li>
                        </ul>
                    </div>

                    <div class="footercolumn">
                        <div class="footertitle">Support</div>
                        <ul>
                            <li><a href="faq.html">FAQ</a></li>
                            <li><a href="contact.html">Contact Us</a></li>
                        </ul>
                    </div>

                    <div class="footercolumn">
                        <div class="footertitle">About</div>
                        <ul>
                            <li><a href="about.html">About Us</a></li>
                            <li><a href="team.html">Meet the Team</a></li>
                            <li><a href="jointeam.html">Join the Team</a></li>
                        </ul>
                    </div>
                </div>
                <div id="footer-p">Website designed by <a href="mailto:zapshareplatform@gmail.com">Team 3</a> for <a href="http://bcit.ca">BCIT</a> COMP 1930
                    <br>
                    &copy; 2019 ZapShare, All Rights Reserved.</div>
            </footer>
        <script>
    
var modal = document.getElementById('id01');

window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
// Initialize the FirebaseUI Widget using Firebase.
var ui = new firebaseui.auth.AuthUI(firebase.auth());
    var uiConfig = {
  callbacks: {
    signInSuccessWithAuthResult: function(authResult, redirectUrl) {
      // User successfully signed in.
      // Return type determines whether we continue the redirect automatically
      // or whether we leave that to developer to handle.
      return true;
    },
    uiShown: function() {
      // The widget is rendered.
      // Hide the loader.
      document.getElementById('loader').style.display = 'none';
    }
  },
  // Will use popup for IDP Providers sign-in flow instead of the default, redirect.
  signInFlow: 'popup',
  signInSuccessUrl: 'index.html',
  signInOptions: [
    //firebase.auth.GoogleAuthProvider.PROVIDER_ID,
    //firebase.auth.FacebookAuthProvider.PROVIDER_ID,
    //firebase.auth.TwitterAuthProvider.PROVIDER_ID,
    //firebase.auth.GithubAuthProvider.PROVIDER_ID,
    firebase.auth.EmailAuthProvider.PROVIDER_ID,
    //firebase.auth.PhoneAuthProvider.PROVIDER_ID
  ],
  // Terms of service url.
  tosUrl: '<your-tos-url>',
  // Privacy policy url.
  privacyPolicyUrl: '<your-privacy-policy-url>'
};
    // The start method will wait until the DOM is loaded.
ui.start('#firebaseui-auth-container', uiConfig);
</script>
    </body>   
</html>